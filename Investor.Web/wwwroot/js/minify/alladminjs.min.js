(function(){typeof Array.prototype.indexOf!="function"&&(Array.prototype.indexOf=function(n,t){for(var i=t||0,r=this.length;i<r;i+=1)if(n===undefined||n===null){if(this[i]===n)return i}else if(this[i]===n)return i;return-1})})(),function(n){var r={gettoaster:function(){var i=n("#"+t.toaster.id);return i.length<1&&(i=n(t.toaster.template).attr("id",t.toaster.id).css(t.toaster.css).addClass(t.toaster["class"]),t.stylesheet&&!n("link[href="+t.stylesheet+"]").length&&n("head").appendTo('<link rel="stylesheet" href="'+t.stylesheet+'">'),n(t.toaster.container).append(i)),i},notify:function(i,r,u){var o=this.gettoaster(),f=n(t.toast.template.replace("%priority%",u)).hide().css(t.toast.css).addClass(t.toast["class"]),e;n(".title",f).css(t.toast.csst).html(i);n(".message",f).css(t.toast.cssm).html(r);t.debug&&window.console&&console.log(toast);o.append(t.toast.display(f));t.donotdismiss.indexOf(u)===-1&&(e=typeof t.timeout=="number"?t.timeout:typeof t.timeout=="object"&&u in t.timeout?t.timeout[u]:1500,setTimeout(function(){t.toast.remove(f,function(){f.remove()})},e))}},i={toaster:{id:"toaster",container:"body",template:"<div><\/div>","class":"toaster",css:{position:"fixed",top:"10px",right:"10px",width:"300px",zIndex:5e4}},toast:{template:'<div class="alert alert-%priority% alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;<\/span><span class="sr-only">Close<\/span><\/button><span class="title"><\/span>: <span class="message"><\/span><\/div>',defaults:{title:"Notice",priority:"success"},css:{},cssm:{},csst:{fontWeight:"bold"},fade:"slow",display:function(n){return n.fadeIn(t.toast.fade)},remove:function(n,i){return n.animate({opacity:"0",padding:"0px",margin:"0px",height:"0px"},{duration:t.toast.fade,complete:i})}},debug:!1,timeout:1500,stylesheet:null,donotdismiss:[]},t={};n.extend(t,i);n.toaster=function(i){var f,e,u,o;if(typeof i=="object")"settings"in i&&(t=n.extend(!0,t,i.settings));else for(f=Array.prototype.slice.call(arguments,0),e=["message","title","priority"],i={},u=0,o=f.length;u<o;u+=1)i[e[u]]=f[u];var h="title"in i&&typeof i.title=="string"?i.title:t.toast.defaults.title,s="message"in i?i.message:null,c="priority"in i&&typeof i.priority=="string"?i.priority:t.toast.defaults.priority;s!==null&&r.notify(h,s,c)};n.toaster.reset=function(){t={};n.extend(t,i)}}(jQuery);let chosenPostsIds=[];$(document).on("click",".delete",function(){if($(this).hasClass("tags"))$("#question").html("Ви дійсно хочете видалити теги? Кільксть: "+chosenPostsIds.length);else if($(this).hasClass("news"))$("#question").html("Ви дійсно хочете видалити новини? Кільксть: "+chosenPostsIds.length);else if($(this).hasClass("blogs"))$("#question").html("Ви дійсно хочете видалити блоги? Кільксть: "+chosenPostsIds.length);else if($(this).hasClass("single-news")||$(this).hasClass("single-blog")){var n=$("input[name='PostId']").val(),t=$(this).data("href");chosenPostsIds.push(n);deleteSinglePost.call(this,t,chosenPostsIds)}});$(document).on("change","tbody td:first-child",function(n){const t="#"+$(this).closest("table").prop("id"),r=tables[t].row($(this).parents("tr")).data();let i=0;t=="#blogsTable"||t=="#newsTable"?i=r.postId:t=="#tagsTable"&&(i=r.tagId);const u=$(n.target).prop("checked");u?chosenPostsIds.push(i):delete chosenPostsIds.splice([chosenPostsIds.indexOf(i)],1);chosenPostsIds.length>0?$(".delete").removeClass("disabled"):$(".delete").addClass("disabled")});$(document).on("click","a.nav-link",function(n){const i=$(this).data("href"),t=$(n.target).data("type");t&&t==="delete"&&deleteObj.call(this,i,chosenPostsIds)});let deleteObj=function(n,t){$.ajax({url:n,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",type:"POST",data:{id:t},success:function(){const n="#"+$(".table").attr("id");$(n).dataTable().fnDestroy();var t="";$("a.nav-link").hasClass("tags")?(initialTable(n),t="Теги"):$("a.nav-link").hasClass("news")?(initialTable(n),t="Статті"):$("a.nav-link").hasClass("blogs")&&(initialTable(n),t="Блоги");chosenPostsIds=[];$.toaster({priority:"warning",title:"Операція успішна",message:`
 ${t} видалено!`,settings:{timeout:4e3}});$(".delete").addClass("disabled")}})},deleteSinglePost=function(n,t){let i=this;$.ajax({url:n,type:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",data:{id:t},success:function(){$(i).hasClass("single-blog")?(chosenPostsIds=[],location.replace("/admin#/content/blogs"),$.toaster({priority:"warning",title:"Операція успішна",message:`Блог видалено!`,settings:{timeout:4e3}})):$(i).hasClass("single-news")&&(chosenPostsIds=[],location.replace("/admin#/content/news"),$.toaster({priority:"warning",title:"Операція успішна",message:`Статтю видалено!`,settings:{timeout:4e3}}))}})},tables={},initialTable=function(n){switch(n){case"#newsTable":tables[n]=$(n).DataTable({ajax:"/api/NewsApi/GetAllNews",columns:[{data:null,orderable:!1,render:function(){return`<div class="text-center">  <label class="custom-control custom-checkbox ">
                                    <input type="checkbox" class="custom-control-input md-check" >
                                    <span class="custom-control-indicator size-check"></span>
                                </label></div>`}},{data:"postId",visible:!1,render:function(n){return n}},{data:"title",render:function(n,t,i){return`<a href="/admin#/post/${i.postId}" data-type="singlepost" class="nav-link max-link-w" data-href="/content/singlepost/${i.postId}">${n}</a>`}},{data:"publishedOn",render:function(n){return`<p class="max-date-w">${moment(n).format("DD.MM.YYYY HH:mm")}<p>`}},{data:"category.name"},{data:"isPublished",render:function(n){return`<div class="text-center">  <label class="custom-control custom-checkbox ">
                                    <input type="checkbox" data-name="IsPublished" class="custom-control-input md-check" ${n?"checked":""}>
                                    <span class="custom-control-indicator size-check"></span>
                                </label></div>`}},{data:"isOnMainPage",render:function(n){return`<div class="text-center">  <label class="custom-control custom-checkbox ">
                                    <input type="checkbox" data-name="IsOnMainPage" class="custom-control-input md-check" ${n?"checked":""}>
                                    <span class="custom-control-indicator size-check"></span>
                                </label></div>`}},{data:"isImportant",render:function(n){return`<div class="text-center">  <label class="custom-control custom-checkbox ">
                                    <input type="checkbox" data-name="IsImportant" class="custom-control-input md-check" ${n?"checked":""}>
                                    <span class="custom-control-indicator size-check"></span>
                                </label></div>`}},{data:"isOnSide",render:function(n){return`<div class="text-center">  <label class="custom-control custom-checkbox ">
                                    <input type="checkbox" data-name="isOnSide" class="custom-control-input md-check" ${n?"checked":""}>
                                    <span class="custom-control-indicator size-check"></span>
                                </label></div>`}},{data:"isOnSlider",render:function(n){return`<div class="text-center">  <label class="custom-control custom-checkbox ">
                                    <input type="checkbox" data-name="isOnSlider" class="custom-control-input md-check" ${n?"checked":""}>
                                    <span class="custom-control-indicator size-check"></span>
                                </label></div>`}}],language:{url:"//cdn.datatables.net/plug-ins/1.10.16/i18n/Ukrainian.json"}});break;case"#blogsTable":tables[n]=$(n).DataTable({ajax:"/api/BlogsApi/GetAllBlogs",columns:[{data:null,orderable:!1,render:function(){return`<div class="text-center">  <label class="custom-control custom-checkbox ">
                                    <input type="checkbox" class="custom-control-input md-check" >
                                    <span class="custom-control-indicator size-check"></span>
                                </label></div>`}},{data:"postId",visible:!1,render:function(n){return n}},{data:"title",render:function(n,t,i){return`<a href="/admin#/blog/${i.postId}" data-type="singleblog" class="nav-link" data-href="/content/singleblog/${i.postId}">${n}</a>`}},{data:null,render:function(n,t,i){return`<a href="blog/blogerpage/${i.author.userName}">${i.author?`${i.author.surname}  ${i.author.name}`:"Unknown"}</a>`}},{data:"createdOn",render:function(n){return moment(n).format("DD.MM.YYYY HH:mm")}},{data:"isPublished",render:function(n){return`<div class="text-center">  <label class="custom-control custom-checkbox ">
                                    <input asp-for="IsPublished" type="checkbox" data-name="IsPublished"  ${n?"checked":""} 
									class="custom-control-input md-check"  name="IsPublished" >
                                    <span class="custom-control-indicator size-check"></span>
                                </label></div>`}}],language:{url:"//cdn.datatables.net/plug-ins/1.10.16/i18n/Ukrainian.json"}});break;case"#tagsTable":tables[n]=$(n).DataTable({ajax:"/api/TagsApi/GetAllTags",columns:[{data:null,orderable:!1,render:function(){return`<div class="text-center"><input type="checkbox" class="md-check"></div>`}},{data:"tagId",visible:!1,render:function(n){return n}},{data:"name",render:function(n){return`<a data-toggle="modal" href="#editTag" class="tag-submit">${n}</a>`}},{data:"postCount",render:function(n){return n}},{data:"url",visible:!1,render:function(n){return n}}],language:{url:"//cdn.datatables.net/plug-ins/1.10.16/i18n/Ukrainian.json"}});break;case"#usersTable":var t=$(`<select></select>`);tables[n]=$(n).DataTable({ajax:{url:"/api/UsersApi/GetAllUsers",dataSrc:function(n){t=$(`<select class="roles"></select>`);for(let i=0;i<n.data.roles.length;i++)t.append(`<option class='${n.data.roles[i]}'>${n.data.roles[i]}</option>`);return n.data.result}},columns:[{data:null,orderable:!1,render:function(){return`<div class="text-center"><input type="checkbox" class="md-check"></div>`}},{data:"id",visible:!1,render:function(n){return n}},{data:null,render:function(n,t,i){return`<a href="/blog/blogerpage/${i.userName}" class="tag-submit">${i.surname} ${i.name}</a>`}},{data:"userName",render:function(n){return n}},{data:"email",render:function(n){return n}},{data:"numberOfBlogs",render:function(n){return n}},{data:"role",render:function(n){var i=t.clone();return i.children(`.${n}`).attr(`selected`,!0),i.prop("outerHTML")}}],language:{url:"//cdn.datatables.net/plug-ins/1.10.16/i18n/Ukrainian.json"}})}},getPartialView=function(n,t=undefined){$.ajax({url:n,type:"GET",success:function(n){$("#container").empty();$("#container").append(n);chosenPostsIds=[];t&&t(`#${$("table").attr("id")}`)},error:function(n){$.ajax({url:`admin/StatusCode/${n.status}`,type:"GET",success:function(n){$("#container").empty();$("#container").append(n)}})}})};$(document).on("change","tbody td:not(:first-child)",function(n){const u=`#${$(this).closest("table").prop("id")}`,f=tables[u].cell(this).index().column,t=tables[u].row($(this).parents("tr")).data(),r=tables[u].settings().init().columns[f].data;var i;$(n.target).is("input")?(i=$(n.target).prop("checked"),tablesUpdetedData[t.postId]?tablesUpdetedData[t.postId][r]=i:(tablesUpdetedData[t.postId]=t,tablesUpdetedData[t.postId][r]=i),n.target.classList.contains("modified")?n.target.classList.remove("modified"):n.target.classList.add("modified")):$(n.target).is("select")&&(i=$(n.target).val(),tablesUpdetedData[t.id]?tablesUpdetedData[t.id][r]=i:(tablesUpdetedData[t.id]=t,tablesUpdetedData[t.id][r]=i,n.target.classList.add("modified")));$(".modified").length>0?$(".update").removeClass("disabled"):$(".update").addClass("disabled")});let tablesUpdetedData={};$(document).on("click","a.nav-link",function(){const t=$(this).data("href"),n=$(this).data("type");if(n&&n==="update"){let n=[];const i=Object.keys(tablesUpdetedData);for(let t=0;t<i.length;t+=1)n.push(tablesUpdetedData[i[t]]);updetePosts.call(this,t,n);tablesUpdetedData={}}});let updetePosts=function(n,t){var i=this;$.ajax({url:n,contentType:"application/x-www-form-urlencoded; charset=utf-8",dataType:"json",type:"POST",data:{content:t},success:function(){$.toaster({priority:"success",title:"Операція успішна",message:`Зміни збережено!`,settings:{timeout:4e3}});$(i).addClass("disabled");$('input[type="checkbox"]').toArray().forEach(function(n){n.classList.remove("modified")})}})},initTypeahead=function(){var n=[],t;tinymce.init({mode:"specific_textareas",selector:".text-editor",theme:"modern",height:"480",plugins:["advlist autolink link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image | print preview media fullpage | forecolor backcolor emoticons",style_formats:[{title:"Bold text",inline:"b"},{title:"Red text",inline:"span",styles:{color:"#ff0000"}},{title:"Red header",block:"h1",styles:{color:"#ff0000"}},{title:"Example 1",inline:"span",classes:"example1"},{title:"Example 2",inline:"span",classes:"example2"},{title:"Table styles"},{title:"Table row 1",selector:"tr",classes:"tablerow1"}]});tinymce.editors.length>0&&(tinymce.execCommand("mceFocus",!0,"Article"),tinymce.execCommand("mceRemoveEditor",!0,"Article"),tinymce.execCommand("mceAddEditor",!0,"Article"));$(document).ready(function(){$.ajax({url:"/api/TagsApi/GetAllTags",type:"GET",success:function(t){t.data.map(t=>{n.push(t.name)})}});$("#updateFormSubmit").on("click",function(n){var t,i,u,e;const r=$(this);r.attr("disabled","disabled");t=$(".updateForm").attr("id");i=new FormData(document.getElementById(t));const f=i.get("Category.Url");i.set("IsOnMainPage",$(`#${t} input[name='IsOnMainPage']`).prop("checked"));i.set("IsPublished",$(`#${t} input[name='IsPublished']`).prop("checked"));i.set("IsImportant",$(`#${t} input[name='IsImportant']`).prop("checked"));i.set("IsOnSide",$(`#${t} input[name='IsOnSide']`).prop("checked"));i.set("IsOnSlider",$(`#${t} input[name='IsOnSlider']`).prop("checked"));i.set("Article",tinyMCE.get("Article").getContent());u=$(`#${t} input[Name='tagsName']`).tagsinput("items");for(let n=0;n<u.length;n++)i.append(`Tags[`+n+`].Name`,u[n]);e=$(`#${t} input[name='Image']`).get(0).files;i.set("Image",$(`#${t} input[name='Image']`).get(0).files[0]);const o=f?"NewsApi":"BlogsApi",s=f?"UpdateNews":"UpdateBlog";$.ajax({type:"POST",url:`/api/${o}/${$(this).data("action")}`,data:i,cache:!1,contentType:!1,processData:!1,success:function(n){console.log(n);$("#updateFormSubmit").data("action",s);$(`#${t} input[name='PostId']`).val(n.id);r.removeAttr("disabled");$(`.deletepost`).removeAttr("hidden");$(`.previewpost`).removeAttr("hidden");$(`.previewpost`).attr("href",n.href);$.toaster({priority:"success",title:"Операція успішна",message:"\nСтаттю збережено!",settings:{timeout:4e3}})},error:function(){r.removeAttr("disabled");$.toaster({priority:"error",title:"Упс",message:"\nЩось пішло не так!",settings:{timeout:4e3}})}});n.preventDefault()});$(document).on("submit",".updateForm",function(n){return n.preventDefault(),!1})});t=function(n){return function(t,i){var r=[];substrRegex=new RegExp(t,"i");$.each(n,function(n,t){substrRegex.test(t)&&r.push(t)});i(r)}};$("#tagTypeahead").tagsinput({typeaheadjs:{name:"tags",source:t(n)}})};$(document).on("click","a.tag-submit",function(){const t=`#${$(this).closest("table").prop("id")}`,i=$(this).closest("tr").index(),n=tables[t].row($(this).parents("tr")).data();$(`${$(this).attr("href")} input[name='TagId']`).val(n.tagId);$(`${$(this).attr("href")} input[name='Url']`).val(n.url);$(`${$(this).attr("href")} input[name='Name']`).val(n.name)});$(document).on("click",".tag-update",function(n){var t=$(this).data("href");let i=new FormData(document.getElementById($(this).attr("form")));n.preventDefault();$.ajax({type:"POST",url:t,data:i,cache:!1,contentType:!1,processData:!1,success:function(){const n="#"+$(".table").attr("id");$(n).dataTable().fnDestroy();initialTable(n);$.toaster({priority:"success",title:"Операція успішна",message:"\nТег збережено!",settings:{timeout:4e4}})}})});const getUrlFragment=function(n){const t=n.indexOf("#");return t!==-1?n.slice(t+1,n.length):undefined};let getContent=function(){const n=location.hash.replace("#","");n.startsWith("/post/")?getPartialView(`admin${n}`,function(){initTypeahead();$("#updateFormSubmit").data("action","UpdateNews")}):n.startsWith("/dashboard")?getPartialView(`admin${n}`,initialGoogleAnalyticsDashboard):n.startsWith("/createpost")?getPartialView(`admin${n}`,function(){initTypeahead();$("#updateFormSubmit").data("action","CreateNews")}):n!==""&&getPartialView(`admin${n}`,initialTable);tablesUpdetedData={};var t=window.location.pathname+window.location.hash;$(".nav-item a").each(function(){$(this).removeClass("active-item")});$(".nav-item a").each(function(){$(this).attr("href")===t&&($(this).addClass("active-item"),$(this).parent().prev(".nav-item a").addClass("active-item"))})};window.addEventListener("popstate",getContent,!1);window.addEventListener("load",getContent,!1);$("#logoff").click(function(n){n.preventDefault();logOff()});let logOff=function(){$.ajax({url:"/admin/account/logoff",type:"POST",success:function(n){window.location.href=n}})},viewSelector=null,timeline=null,newTimelineOption={reportType:"ga",query:{dimensions:"ga:date",metrics:"ga:sessions","start-date":"30daysAgo","end-date":"yesterday"},chart:{type:"LINE",container:"timeline"}},initialGoogleAnalyticsDashboard=function(){if(viewSelector&&timeline){viewSelector.execute();timeline=new gapi.analytics.googleCharts.DataChart(newTimelineOption);return}gapi.analytics.auth.authorize({container:"auth-button",clientid:"565347094570-46d26vk6cbpknqfh6aiu3l8btr8lde5h.apps.googleusercontent.com"});viewSelector=new gapi.analytics.ViewSelector({container:"view-selector"});timeline=new gapi.analytics.googleCharts.DataChart(newTimelineOption);gapi.analytics.auth.on("success",function(){viewSelector.execute()});viewSelector.on("change",function(n){console.log(n);var t={query:{ids:n}};timeline.set(t).execute()})};